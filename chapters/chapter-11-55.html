<p>The <code class="code">publishCityTrendUpdate</code> method receives a list of Kafka records for a given city and from a time window. We first have to check if there is any record, otherwise there is nothing to do. With records we can use Java streams to compute the sum with a <code class="code">reduce</code> operator, then prepare a Kafka record with several entries: a timestamp, the time window duration in seconds, the city, how many steps have been recorded, and how many updates were observed during the time window. Once this is done we write the record to the <code class="code">event-stats.city-trend.updates</code> Kafka topic.</p>